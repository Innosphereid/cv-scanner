sequenceDiagram
    autonumber
    participant C as "Client"
    participant A as "API (Auth Controller/Service)"
    participant D as "DB (Users, OTPReset, TokenVersion)"

    C->>A: POST /api/v1/auth/reset-password { email, otp, newPassword }
    A->>D: Find user by email
    alt Not found
      A-->>C: 400 Bad Request (Invalid OTP or expired)
    else Found
      A->>D: Validate OTP (not expired, matches hash, unused)
      alt Invalid/Expired
        A-->>C: 400 Bad Request (Invalid OTP or expired)
      else Valid
        A->>A: Validate password policy
        alt Weak password
          A-->>C: 400 Bad Request (Password does not meet policy)
        else Strong password
          A->>A: Hash new password (bcrypt)
          A->>D: Update user.passwordHash
          A->>D: Invalidate OTP (used)
          A->>D: Revoke sessions by bumping tokenVersion
          A-->>C: 200 OK (Password reset successful)
        end
      end
    end


